int sensorPin = A0;
int leftEncoderValue = 0;
int rightEncoderValue = 0;


int S1 = 0;
int S2 = 143;
int S3 = 329;
int S4 = 504;
int S5 = 742;

int E1 = 5;
int E2 = 6;
int M1 = 4;
int M2 = 7;

float LEpowerInPercents; float REpowerInPercents;


void setup() 
{

  Serial. begin (9600);
  attachInterrupt (0, leftEncoder, CHANGE);
  attachInterrupt (1, rightEncoder, CHANGE);

}


void leftEncoder()
{
  leftEncoderValue++;
  Serial.println ("leftEncoderValue = ");
  Serial.println (leftEncoderValue/4);
}

void rightEncoder()
{
  rightEncoderValue++;
  Serial.println ("rightEncoderValue = ");
  Serial.println (rightEncoderValue/4);
}



unsigned int S1_Status;


void go(float LEpowerInPercents, float REpowerInPercents)
{
  while (leftEncoderValue/4 < rightEncoderValue/4)
  {
     REpowerInPercents = REpowerInPercents - 10;                //<--- Не уменьшается мощность двигателя.
          Serial.println (LEpowerInPercents);
  }
  while (rightEncoderValue/4 < leftEncoderValue/4)
  {
     LEpowerInPercents = LEpowerInPercents - 10;

  }  
     
  float onePercent = 2.55;
  float LEpower = LEpowerInPercents*onePercent;
  float REpower = REpowerInPercents*onePercent;
    analogWrite (E1, LEpower);
    digitalWrite(M1, HIGH);
    analogWrite (E2, REpower);
    digitalWrite(M2, HIGH);

}


void stop(void)
{
  digitalWrite (E1, LOW);
  digitalWrite (E2, LOW);
}




void loop() 
{
  int sensorValue = analogRead(sensorPin); 
  
  if (sensorValue == S1)
  {
    S1_Status = 1;
    go (100, 100);
  }
  
  else
  {
    leftEncoderValue = 0;
    rightEncoderValue = 0;
    S1_Status = 0;
    stop();
  }

  
}

